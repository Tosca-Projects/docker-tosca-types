tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: docker-draft.03-volume
  template_version: 2.0.0-SNAPSHOT
  template_author: alien4cloud

description: >
  A nocellar and a mongo container inside a deployment unit also hosting a volume

imports:
  - docker-types:1.4.0-SNAPSHOT
  - tosca-normative-types:2.0.0-SNAPSHOT
  - docker-draft.sandbox.samples:2.0.0-SNAPSHOT

topology_template:

  description: >
    A nocellar and a mongo container inside a deployment unit also hosting a volume

  node_templates:

    DockerExtVolume:
      type: alien.nodes.DockerExtVolume
      requirements:
        - host:
            node: ContainerDeploymentUnit
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
        - attachment:
            node: Nodecellar
            capability: alien.capabilities.DockerVolumeAttachment
            relationship: alien.relationships.MountDockerVolume
            properties:
              container_path: /tmp/var
        - attachment_mongo:
            type_requirement: attachment
            node: Mongo
            capability: alien.capabilities.DockerVolumeAttachment
            relationship: alien.relationships.MountDockerVolume
            properties:
              container_path: /tmp/var

    Nodecellar:
      type: alien.nodes.Application.Docker.Nodecellar
      properties:
        docker_run_cmd: "cd /nodecellar && nodejs server.js"
        docker_env_vars:
          LOG_LEVEL: "DEBUG"
        cpu_share: 1.0
        mem_share: "1024 MB"
      requirements:
        - host:
            node: ContainerDeploymentUnit
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
        - mongo_db:
            node: Mongo
            capability: alien.capabilities.endpoint.docker.Mongo
            relationship: tosca.relationships.ConnectsTo

    Mongo:
      type: alien.nodes.Application.Docker.Mongo
      properties:
        cpu_share: 1.0
        mem_share: "512 MB"
      requirements:
        - host:
            node: ContainerDeploymentUnit
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn

    ContainerDeploymentUnit:
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit
