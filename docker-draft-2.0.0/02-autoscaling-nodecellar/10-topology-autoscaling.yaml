tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: docker-draft.02-autoscaling-nodecellar
  template_version: 2.0.0-SNAPSHOT
  template_author: alien4cloud

description: >
  A nodecellar hosted on a container unit with autoscalling policy and a mongo as a single container

imports:
  - docker-types:1.4.0-SNAPSHOT
  # https://github.com/alien4cloud/tosca-normative-types/blob/tests/2.0.0/normative-types.yml
  - tosca-normative-types:1.0.0-SNAPSHOT
  - docker-draft.sandbox.samples:2.0.0-SNAPSHOT

topology_template:

  description: >
    A nodecellar hosted on a container unit with autoscalling policy and a mongo as a single container

  node_templates:

    Nodecellar:
      type: alien.nodes.Application.Docker.Nodecellar
      properties:
        docker_run_cmd: "cd /nodecellar && nodejs server.js"
        docker_env_vars:
          LOG_LEVEL: "DEBUG"
        cpu_share: 1.0
        mem_share: "1024 MB"
      requirements:
        - host:
            node: ContainerDeploymentUnit
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
        - mongo_db:
            node: Mongo
            capability: alien.capabilities.endpoint.docker.Mongo
            relationship: tosca.relationships.ConnectsTo
      # capabilities:
      #   nodecellar_app:
      #     properties:
      #       docker_bridge_port_mapping: 0
      #       port: 3000
      #       protocol: tcp
      #       secure: false
      #       network_name: PRIVATE
      #       initiator: source

    Mongo:
      type: alien.nodes.Application.Docker.Mongo
      properties:
        cpu_share: 1.0
        mem_share: "512 MB"
      # requirements:
      #   - host:
      #       node: ContainerDeploymentUnit
      #       capability: tosca.capabilities.Container.Docker
      #       relationship: tosca.relationships.HostedOn
      # capabilities:
      #   mongo_db:
      #     properties:
      #       docker_bridge_port_mapping: 0
      #       port: 27017
      #       protocol: tcp
      #       secure: false
      #       network_name: PRIVATE
      #       initiator: source
      #   scalable:
      #     properties:
      #       min_instances: 1
      #       max_instances: 1
      #       default_instances: 1

    ContainerDeploymentUnit:
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit

  policies:
    - auto_scaling_policy:
        type: tosca.policies.Scaling
        description: a sample autoscaling policy for the nodecellar DU
        # metadata:
        #   a_meta: a meta value
        #   another_meta: another meta value
        # properties:
        #   sample_property: sample prop value
        targets: [ContainerDeploymentUnit]
